<div class="game-container">
  <div class="game-header">
    <button class="btn-danger" (click)="backToLobby()">Back to Lobby</button>
    <span *ngIf="isSpectator" class="spectator-badge">ğŸ‘ï¸ Spectator Mode</span>
  </div>

  <div *ngIf="banner" class="banner" [class.banner-warning]="banner.type === 'warning'">
    <span>{{ banner.message }}</span>
    <button (click)="dismissBanner()">âœ•</button>
  </div>

  <div class="game-content">
    <!-- Left Panel: Statistics -->
    <div class="game-info">
      <h4 class="stats-title">Statistics</h4>
      <div class="stats-content">
        <div class="stat-item">
          <span class="stat-label">Food Eaten:</span>
          <span class="stat-value">{{ getTotalFoodEaten() }}</span>
        </div>
        <div class="stat-item">
          <span class="stat-label">Games Won:</span>
          <span class="stat-value">{{ getGamesWon() }}</span>
        </div>
        <div class="stat-item">
          <span class="stat-label">Games Played:</span>
          <span class="stat-value">{{ getGamesPlayed() }}</span>
        </div>
      </div>
      
      <div *ngIf="gameState?.snakes" class="scores">
        <h4 class="scores-title">Current Scores</h4>
        <div *ngFor="let snake of gameState!.snakes" class="score-item">
          <div class="score-color" [style.background-color]="snake.color"></div>
          <span>{{ snake.username || 'Player' }}: {{ snake.score }}</span>
        </div>
      </div>
    </div>

    <div class="canvas-container">
      <div 
        *ngIf="shouldShowStatusBanner()" 
        class="status-banner">
        {{ getStatusBannerText() }}
      </div>
      <canvas #gameCanvas class="game-canvas"></canvas>
      
      <!-- Waiting Modal -->
      <div *ngIf="!gameState || gameState?.status === 'waiting'" class="modal-overlay">
        <div class="modal-content waiting-modal">
          <div *ngIf="!gameState" class="loading-state">
            <div class="loading-spinner"></div>
            <p>Loading game...</p>
          </div>
          
          <div *ngIf="gameState?.status === 'waiting'">
            <h3 class="waiting-title">Waiting for Players</h3>
            
            <div *ngIf="!isSpectator" class="players-status">
              <div class="player-card" [class.ready]="getCurrentPlayerStatus()?.ready">
                <div class="avatar" [style.border-color]="'#FF0000'">{{ getInitial(getCurrentPlayerStatus()?.username) }}</div>
                <div class="player-info">
                  <span class="player-name">{{ getCurrentPlayerStatus()?.username || 'You' }}</span>
                  <span class="badge" [class.badge-ready]="getCurrentPlayerStatus()?.ready">
                    {{ getCurrentPlayerStatus()?.ready ? 'Ready' : 'Waiting' }}
                  </span>
                </div>
              </div>

              <div class="player-card" [class.ready]="getOtherPlayer()?.ready">
                <div class="avatar" [style.border-color]="'#0000FF'">{{ getInitial(getOtherPlayer()?.username) }}</div>
                <div class="player-info">
                  <span class="player-name">{{ getOtherPlayer()?.username || 'Opponent' }}</span>
                  <span class="badge" [class.badge-ready]="getOtherPlayer()?.ready">
                    {{ getOtherPlayer()?.ready ? 'Ready' : 'Waiting' }}
                  </span>
                </div>
              </div>
            </div>
            
            <div *ngIf="!isSpectator" class="ready-action">
              <p class="ready-prompt" *ngIf="!isReady">
                Click the button below when you're ready to start:
              </p>
              <p class="ready-prompt ready-text" *ngIf="isReady">
                You're ready! Waiting for {{ getOtherPlayer()?.username || 'opponent' }}...
              </p>
              <button 
                class="btn-ready btn-small" 
                [class.btn-ready-active]="isReady"
                [class.btn-ready-inactive]="!isReady"
                (click)="playerReady()"
                [disabled]="isReady"
              >
                <span *ngIf="!isReady">ğŸ® Click to Ready</span>
                <span *ngIf="isReady">âœ“ Ready!</span>
              </button>
            </div>
            
            <div *ngIf="isSpectator" class="spectator-waiting">
              <p>ğŸ‘ï¸ Waiting for players to be ready...</p>
            </div>
          </div>
        </div>
      </div>
      
      <!-- Game Over Overlay -->
      <div *ngIf="gameState?.status === 'finished'" class="game-over-overlay">
        <div class="game-over-modal">
          <div class="game-over-icon">ğŸ®</div>
          <h2>Game Over!</h2>
          <div class="winner-info">
            <p *ngIf="gameState && gameState.winner && gameState.winner !== 'tie'" class="winner-text">
              <span class="winner-label">Winner:</span>
              <span class="winner-name">{{ getWinnerUsername() }}</span>
            </p>
            <p *ngIf="gameState && gameState.winner === 'tie'" class="tie-text">It's a tie! ğŸ‰</p>
          </div>
          
          <div *ngIf="!isSpectator" class="rematch-section">
            <p *ngIf="rematchRequestedByOpponent" class="rematch-alert">
              {{ rematchRequestMessage }}
            </p>
            <p *ngIf="hasRequestedRematch()" class="rematch-waiting">
              Waiting for {{ getOtherPlayer()?.username || 'opponent' }} to accept...
            </p>
            <p *ngIf="!rematchRequestedByOpponent && !hasRequestedRematch()" class="rematch-prompt">
              Want to play again?
            </p>
            <p *ngIf="rematchCountdown > 0" class="rematch-countdown">Rematch starting in: {{ rematchCountdown }}</p>
            
            <button 
              *ngIf="rematchRequestedByOpponent"
              class="btn-success btn-rematch" 
              (click)="acceptRematch()"
            >
              âœ“ Accept Rematch
            </button>
            <button 
              *ngIf="!rematchRequestedByOpponent && !hasRequestedRematch()"
              class="btn-success btn-rematch" 
              (click)="requestRematch()"
            >
              ğŸ”„ Request Rematch
            </button>
          </div>
          
          <button class="btn-primary btn-lobby" (click)="backToLobby()">Back to Lobby</button>
        </div>
      </div>
    </div>

    <div class="controls-info">
      <h4>Controls</h4>
      <p *ngIf="!isSpectator && gameState?.status === 'playing'">Use arrow keys or WASD to move your snake</p>
      <p *ngIf="!isSpectator && gameState?.status !== 'playing'">Game controls will appear when the game starts</p>
      <p *ngIf="isSpectator">You are watching this game</p>
      
      <!-- Touch controls for mobile/tablet -->
      <div *ngIf="!isSpectator && gameState?.status === 'playing'" class="touch-controls">
        <button 
          class="btn-control up" 
          (touchstart)="handleTouchMove('up'); $event.preventDefault()" 
          (touchend)="$event.preventDefault()"
          (mousedown)="handleTouchMove('up')"
        >
          â†‘
        </button>
        <button 
          class="btn-control left" 
          (touchstart)="handleTouchMove('left'); $event.preventDefault()" 
          (touchend)="$event.preventDefault()"
          (mousedown)="handleTouchMove('left')"
        >
          â†
        </button>
        <button 
          class="btn-control down" 
          (touchstart)="handleTouchMove('down'); $event.preventDefault()" 
          (touchend)="$event.preventDefault()"
          (mousedown)="handleTouchMove('down')"
        >
          â†“
        </button>
        <button 
          class="btn-control right" 
          (touchstart)="handleTouchMove('right'); $event.preventDefault()" 
          (touchend)="$event.preventDefault()"
          (mousedown)="handleTouchMove('right')"
        >
          â†’
        </button>
      </div>
    </div>
  </div>
</div>

